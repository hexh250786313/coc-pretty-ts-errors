"use strict";var k=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var n in t)k(e,n,{get:t[n],enumerable:!0})},S=(e,t,n,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of j(t))!P.call(e,i)&&i!==n&&k(e,i,{get:()=>t[i],enumerable:!(a=H(t,i))||a.enumerable});return e};var $=e=>S(k({},"__esModule",{value:!0}),e);var q={};R(q,{activate:()=>W});module.exports=$(q);var s=require("coc.nvim"),T=require("pretty-ts-errors-markdown"),x="pretty-ts-errors",m="tsserver";async function C(e){let{nvim:t}=s.workspace;(await t.getOption("runtimepath")).split(",").includes(e)||await t.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}function I(e){let t=/```[\s\S]*?```/g,n=/`([^`]+)`/g,a=[];return e.replace(t,o=>(a.push(o),"\0")).replace(/</g,"\\<").replace(/>/g,"\\>").replace(n,"\x1B[33m$1\x1B[0m").replace(/\0/g,()=>a.shift()||"")}var N=e=>`\x1B[31m${e}\x1B[0m`,O=e=>`\x1B[32m${e}\x1B[0m`,w=e=>`\x1B[36m${e}\x1B[0m`,A={[s.DiagnosticSeverity.Error]:N,[s.DiagnosticSeverity.Warning]:O,[s.DiagnosticSeverity.Information]:w,[s.DiagnosticSeverity.Hint]:w},L=(e,t)=>e.map(a=>{let i=I((0,T.formatDiagnostic)(a)).split(`
`).map((r,l)=>{if(l===0&&(r=A[a.severity||s.DiagnosticSeverity.Error](r.substring(3,r.length))),r=r.replace(/(\['?)([^' ]+)('?.+?ğŸ“„\])/g,(o,p,y)=>`[${y} \u{1F4C4}]`),t.showLink===!1&&(r=r.replace(/\[(ğŸ”—|ğŸŒ)\]\(.*\)/g,"")),t.codeBlockHighlightType==="prettytserr")r=r.replace(/(?<=(^\s*```))typescript/,"prettytserr");else{let o=r.match(/^(\s*)```typescript.*/),p=(o==null?void 0:o[1].length)||0;r=r.replace(/(?<=(^\s*```))typescript/,`typescript
${" ".repeat(p)}type Type =`)}return r}).join(`
`);return{...a,message:`${i}

`,filetype:"markdown",source:x}}),D={},g=class g{constructor(t){this.value=t;this.value=t}showInDiagnostic(){return this.value===g.Diagnostic||this.value===g.Both}showInHover(){return this.value===g.Hover||this.value===g.Both}};g.Diagnostic=0,g.Hover=1,g.Both=2;var d=g;async function W(e){let t=s.workspace.getConfiguration(x),n=t.get("enable",!0),a=t.get("showLink",!1),i=t.get("mode",d.Both),r=t.get("codeBlockHighlightType","prettytserr"),l=t.get("serverName",m);if(m=l,!n)return null;let o=new d(i),p=s.services.getService(m),y=t.get("experimental.filterOriginalTsErrors",!0);if(!p)return console.error(`Tsserver not found: serverName '${m}' is not available.`),null;p.onServiceReady(()=>{let v=s.diagnosticManager.create(x),u=s.diagnosticManager.getCollectionByName(l);u==null||u.onDidDiagnosticsChange(f=>{let c=s.workspace.getDocument(f);if((c==null?void 0:c.bufnr)!==void 0){let h=s.diagnosticManager.buffers.getItem(c==null?void 0:c.bufnr);if(h){let E=s.diagnosticManager.getDiagnostics(h)[l],B=L(E,{showLink:a,codeBlockHighlightType:r});setTimeout(()=>{D[f]=[...B],o.showInDiagnostic()&&(y&&(u.diagnosticsMap.delete(f),h.config.autoRefresh&&h.update(l,[])),v.set(f,B))})}}})}),await C(e.extensionPath),e.subscriptions.push(s.languages.registerHoverProvider([{language:"javascript"},{language:"javascriptreact"},{language:"javascript.jsx"},{language:"typescript"},{language:"typescriptreact"},{language:"typescript.tsx"},{language:"typescript.jsx"},{language:"jsx-tags"},{language:"jsonc"},{language:"vue"}],{provideHover:(v,u)=>{var c;return o.showInHover()?{contents:(c=D[v.uri])==null?void 0:c.map(b=>M(u,b.range)?{language:"markdown",value:b.message}:null).filter(Boolean)}:null}}))}function M(e,t){let n=!0;return(e.line<t.start.line||e.line>t.end.line)&&(n=!1),e.line===t.start.line&&e.character<t.start.character&&(n=!1),e.line===t.end.line&&e.character>t.end.character&&(n=!1),n}0&&(module.exports={activate});
