"use strict";var K=Object.create;var _=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var W=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var J=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),O=(e,r)=>{for(var i in r)_(e,i,{get:r[i],enumerable:!0})},C=(e,r,i,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of z(r))!q.call(e,t)&&t!==i&&_(e,t,{get:()=>r[t],enumerable:!(n=M(r,t))||n.enumerable});return e};var G=(e,r,i)=>(i=e!=null?K(W(e)):{},C(r||!e||!e.__esModule?_(i,"default",{value:e,enumerable:!0}):i,e)),Q=e=>C(_({},"__esModule",{value:!0}),e);var $=J((y,U)=>{"use strict";var H=require("crypto");y=U.exports=w;function w(e,r){return r=R(e,r),X(e,r)}y.sha1=function(e){return w(e)};y.keys=function(e){return w(e,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})};y.MD5=function(e){return w(e,{algorithm:"md5",encoding:"hex"})};y.keysMD5=function(e){return w(e,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var m=H.getHashes?H.getHashes().slice():["sha1","md5"];m.push("passthrough");var N=["buffer","hex","binary","base64"];function R(e,r){r=r||{};var i={};if(i.algorithm=r.algorithm||"sha1",i.encoding=r.encoding||"hex",i.excludeValues=!!r.excludeValues,i.algorithm=i.algorithm.toLowerCase(),i.encoding=i.encoding.toLowerCase(),i.ignoreUnknown=r.ignoreUnknown===!0,i.respectType=r.respectType!==!1,i.respectFunctionNames=r.respectFunctionNames!==!1,i.respectFunctionProperties=r.respectFunctionProperties!==!1,i.unorderedArrays=r.unorderedArrays===!0,i.unorderedSets=r.unorderedSets!==!1,i.unorderedObjects=r.unorderedObjects!==!1,i.replacer=r.replacer||void 0,i.excludeKeys=r.excludeKeys||void 0,typeof e>"u")throw new Error("Object argument required.");for(var n=0;n<m.length;++n)m[n].toLowerCase()===i.algorithm.toLowerCase()&&(i.algorithm=m[n]);if(m.indexOf(i.algorithm)===-1)throw new Error('Algorithm "'+i.algorithm+'"  not supported. supported values: '+m.join(", "));if(N.indexOf(i.encoding)===-1&&i.algorithm!=="passthrough")throw new Error('Encoding "'+i.encoding+'"  not supported. supported values: '+N.join(", "));return i}function P(e){if(typeof e!="function")return!1;var r=/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i;return r.exec(Function.prototype.toString.call(e))!=null}function X(e,r){var i;r.algorithm!=="passthrough"?i=H.createHash(r.algorithm):i=new L,typeof i.write>"u"&&(i.write=i.update,i.end=i.update);var n=D(r,i);if(n.dispatch(e),i.update||i.end(""),i.digest)return i.digest(r.encoding==="buffer"?void 0:r.encoding);var t=i.read();return r.encoding==="buffer"?t:t.toString(r.encoding)}y.writeToStream=function(e,r,i){return typeof i>"u"&&(i=r,r={}),r=R(e,r),D(r,i).dispatch(e)};function D(e,r,i){i=i||[];var n=function(t){return r.update?r.update(t,"utf8"):r.write(t,"utf8")};return{dispatch:function(t){e.replacer&&(t=e.replacer(t));var a=typeof t;return t===null&&(a="null"),this["_"+a](t)},_object:function(t){var a=/\[object (.*)\]/i,l=Object.prototype.toString.call(t),s=a.exec(l);s?s=s[1]:s="unknown:["+l+"]",s=s.toLowerCase();var f=null;if((f=i.indexOf(t))>=0)return this.dispatch("[CIRCULAR:"+f+"]");if(i.push(t),typeof Buffer<"u"&&Buffer.isBuffer&&Buffer.isBuffer(t))return n("buffer:"),n(t);if(s!=="object"&&s!=="function"&&s!=="asyncfunction")if(this["_"+s])this["_"+s](t);else{if(e.ignoreUnknown)return n("["+s+"]");throw new Error('Unknown object type "'+s+'"')}else{var o=Object.keys(t);e.unorderedObjects&&(o=o.sort()),e.respectType!==!1&&!P(t)&&o.splice(0,0,"prototype","__proto__","constructor"),e.excludeKeys&&(o=o.filter(function(u){return!e.excludeKeys(u)})),n("object:"+o.length+":");var h=this;return o.forEach(function(u){h.dispatch(u),n(":"),e.excludeValues||h.dispatch(t[u]),n(",")})}},_array:function(t,a){a=typeof a<"u"?a:e.unorderedArrays!==!1;var l=this;if(n("array:"+t.length+":"),!a||t.length<=1)return t.forEach(function(o){return l.dispatch(o)});var s=[],f=t.map(function(o){var h=new L,u=i.slice(),d=D(e,h,u);return d.dispatch(o),s=s.concat(u.slice(i.length)),h.read().toString()});return i=i.concat(s),f.sort(),this._array(f,!1)},_date:function(t){return n("date:"+t.toJSON())},_symbol:function(t){return n("symbol:"+t.toString())},_error:function(t){return n("error:"+t.toString())},_boolean:function(t){return n("bool:"+t.toString())},_string:function(t){n("string:"+t.length+":"),n(t.toString())},_function:function(t){n("fn:"),P(t)?this.dispatch("[native]"):this.dispatch(t.toString()),e.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(t.name)),e.respectFunctionProperties&&this._object(t)},_number:function(t){return n("number:"+t.toString())},_xml:function(t){return n("xml:"+t.toString())},_null:function(){return n("Null")},_undefined:function(){return n("Undefined")},_regexp:function(t){return n("regex:"+t.toString())},_uint8array:function(t){return n("uint8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint8clampedarray:function(t){return n("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(t))},_int8array:function(t){return n("int8array:"),this.dispatch(Array.prototype.slice.call(t))},_uint16array:function(t){return n("uint16array:"),this.dispatch(Array.prototype.slice.call(t))},_int16array:function(t){return n("int16array:"),this.dispatch(Array.prototype.slice.call(t))},_uint32array:function(t){return n("uint32array:"),this.dispatch(Array.prototype.slice.call(t))},_int32array:function(t){return n("int32array:"),this.dispatch(Array.prototype.slice.call(t))},_float32array:function(t){return n("float32array:"),this.dispatch(Array.prototype.slice.call(t))},_float64array:function(t){return n("float64array:"),this.dispatch(Array.prototype.slice.call(t))},_arraybuffer:function(t){return n("arraybuffer:"),this.dispatch(new Uint8Array(t))},_url:function(t){return n("url:"+t.toString(),"utf8")},_map:function(t){n("map:");var a=Array.from(t);return this._array(a,e.unorderedSets!==!1)},_set:function(t){n("set:");var a=Array.from(t);return this._array(a,e.unorderedSets!==!1)},_file:function(t){return n("file:"),this.dispatch([t.name,t.size,t.type,t.lastModfied])},_blob:function(){if(e.ignoreUnknown)return n("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return n("domwindow")},_bigint:function(t){return n("bigint:"+t.toString())},_process:function(){return n("process")},_timer:function(){return n("timer")},_pipe:function(){return n("pipe")},_tcp:function(){return n("tcp")},_udp:function(){return n("udp")},_tty:function(){return n("tty")},_statwatcher:function(){return n("statwatcher")},_securecontext:function(){return n("securecontext")},_connection:function(){return n("connection")},_zlib:function(){return n("zlib")},_context:function(){return n("context")},_nodescript:function(){return n("nodescript")},_httpparser:function(){return n("httpparser")},_dataview:function(){return n("dataview")},_signal:function(){return n("signal")},_fsevent:function(){return n("fsevent")},_tlswrap:function(){return n("tlswrap")}}}function L(){return{buf:"",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}});var st={};O(st,{activate:()=>it});module.exports=Q(st);var c=require("coc.nvim"),B=G($()),I=require("pretty-ts-errors-markdown"),S="pretty-ts-errors",x="tsserver";async function Y(e){let{nvim:r}=c.workspace;(await r.getOption("runtimepath")).split(",").includes(e)||await r.command(`execute 'noa set rtp+='.fnameescape('${e.replace(/'/g,"''")}')`)}function Z(e){let r=/```[\s\S]*?```/g,i=/`([^`]+)`/g,n=[];return e.replace(r,s=>(n.push(s),"\0")).replace(/</g,"\\<").replace(/>/g,"\\>").replace(i,"\x1B[33m$1\x1B[0m").replace(/\0/g,()=>n.shift()||"")}var tt=e=>`\x1B[1;31m${e}\x1B[0m`,et=e=>`\x1B[1;32m${e}\x1B[0m`,F=e=>`\x1B[1;36m${e}\x1B[0m`,rt={[c.DiagnosticSeverity.Error]:tt,[c.DiagnosticSeverity.Warning]:et,[c.DiagnosticSeverity.Information]:F,[c.DiagnosticSeverity.Hint]:F},nt=(e,r)=>e.map(n=>{let t=Z((0,I.formatDiagnostic)(n)).split(`
`).map((a,l)=>{if(l===0&&(a=rt[n.severity||c.DiagnosticSeverity.Error](a.substring(3,a.length))),a=a.replace(/(\['?)([^' ]+)('?.+?📄\])/g,(s,f,o)=>`[${o} \u{1F4C4}]`),r.showLink===!1&&(a=a.replace(/\[(🔗|🌐)\]\(.*\)/g,"")),r.codeBlockHighlightType==="prettytserr")a=a.replace(/(?<=(^\s*```))typescript/,"prettytserr");else{let s=a.match(/^(\s*)```typescript.*/),f=(s==null?void 0:s[1].length)||0;a=a.replace(/(?<=(^\s*```))typescript/,`typescript
${" ".repeat(f)}type Type =`)}return a}).join(`
`);return{...n,message:`${t}

`,filetype:"markdown",source:S}}),j={},p=class p{constructor(r){this.value=r;this.value=r}showInDiagnostic(){return this.value===p.Diagnostic||this.value===p.Both}showInHover(){return this.value===p.Hover||this.value===p.Both}};p.Diagnostic=0,p.Hover=1,p.Both=2;var A=p;async function it(e){let r=c.workspace.getConfiguration(S),i=r.get("enable",!0),n=r.get("showLink",!1),t=r.get("mode",A.Both),a=r.get("codeBlockHighlightType","prettytserr"),l=r.get("serverName",x),s=r.get("sourceName",l)||l;if(x=l,!i)return null;let f=new A(t),o=c.services.getService(x);if(!o)return console.error(`Tsserver not found: serverName '${x}' is not available.`),null;o.onServiceReady(()=>{let h=c.diagnosticManager.create(S);c.diagnosticManager.onDidRefresh(async({diagnostics:u,uri:d})=>{if(u.length===0){j[d]=[],f.showInDiagnostic()&&h.set(d,[]);return}let v=[],b=u.filter(g=>{if(g.source===s){let k=(0,B.default)({code:g.code,range:g.range});return v.push(k),!0}}),E=[],V=u.filter(g=>{if(g.source===S){let k=(0,B.default)({code:g.code,range:g.range});return E.push(k),!0}});if(b.length===V.length&&v.every(g=>E.includes(g)))return;let T=nt(b,{showLink:n,codeBlockHighlightType:a});setTimeout(()=>{j[d]=[...T],f.showInDiagnostic()&&h.set(d,T)})})}),await Y(e.extensionPath),e.subscriptions.push(c.languages.registerHoverProvider([{language:"javascript"},{language:"javascriptreact"},{language:"javascript.jsx"},{language:"typescript"},{language:"typescriptreact"},{language:"typescript.tsx"},{language:"typescript.jsx"},{language:"jsx-tags"},{language:"jsonc"}],{provideHover:(h,u)=>{var v;return f.showInHover()?{contents:(v=j[h.uri])==null?void 0:v.map(b=>at(u,b.range)?{language:"markdown",value:b.message}:null).filter(Boolean)}:null}}))}function at(e,r){let i=!0;return(e.line<r.start.line||e.line>r.end.line)&&(i=!1),e.line===r.start.line&&e.character<r.start.character&&(i=!1),e.line===r.end.line&&e.character>r.end.character&&(i=!1),i}0&&(module.exports={activate});
