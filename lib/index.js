"use strict";var z=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var X=Object.prototype.hasOwnProperty;var Y=(y,f)=>{for(var w in f)z(y,w,{get:f[w],enumerable:!0})},ee=(y,f,w,I)=>{if(f&&typeof f=="object"||typeof f=="function")for(let p of V(f))!X.call(y,p)&&p!==w&&z(y,p,{get:()=>f[p],enumerable:!(I=Q(f,p))||I.enumerable});return y};var te=y=>ee(z({},"__esModule",{value:!0}),y);var le={};Y(le,{activate:()=>ce});module.exports=te(le);var P=require("coc.nvim");var W;(()=>{"use strict";var y={470:p=>{function m(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function x(t,e){for(var n,s="",i=0,o=-1,l=0,u=0;u<=t.length;++u){if(u<t.length)n=t.charCodeAt(u);else{if(n===47)break;n=47}if(n===47){if(!(o===u-1||l===1))if(o!==u-1&&l===2){if(s.length<2||i!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){var b=s.lastIndexOf("/");if(b!==s.length-1){b===-1?(s="",i=0):i=(s=s.slice(0,b)).length-1-s.lastIndexOf("/"),o=u,l=0;continue}}else if(s.length===2||s.length===1){s="",i=0,o=u,l=0;continue}}e&&(s.length>0?s+="/..":s="..",i=2)}else s.length>0?s+="/"+t.slice(o+1,u):s=t.slice(o+1,u),i=u-o-1;o=u,l=0}else n===46&&l!==-1?++l:l=-1}return s}var k={resolve:function(){for(var t,e="",n=!1,s=arguments.length-1;s>=-1&&!n;s--){var i;s>=0?i=arguments[s]:(t===void 0&&(t=process.cwd()),i=t),m(i),i.length!==0&&(e=i+"/"+e,n=i.charCodeAt(0)===47)}return e=x(e,!n),n?e.length>0?"/"+e:"/":e.length>0?e:"."},normalize:function(t){if(m(t),t.length===0)return".";var e=t.charCodeAt(0)===47,n=t.charCodeAt(t.length-1)===47;return(t=x(t,!e)).length!==0||e||(t="."),t.length>0&&n&&(t+="/"),e?"/"+t:t},isAbsolute:function(t){return m(t),t.length>0&&t.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var t,e=0;e<arguments.length;++e){var n=arguments[e];m(n),n.length>0&&(t===void 0?t=n:t+="/"+n)}return t===void 0?".":k.normalize(t)},relative:function(t,e){if(m(t),m(e),t===e||(t=k.resolve(t))===(e=k.resolve(e)))return"";for(var n=1;n<t.length&&t.charCodeAt(n)===47;++n);for(var s=t.length,i=s-n,o=1;o<e.length&&e.charCodeAt(o)===47;++o);for(var l=e.length-o,u=i<l?i:l,b=-1,v=0;v<=u;++v){if(v===u){if(l>u){if(e.charCodeAt(o+v)===47)return e.slice(o+v+1);if(v===0)return e.slice(o+v)}else i>u&&(t.charCodeAt(n+v)===47?b=v:v===0&&(b=0));break}var $=t.charCodeAt(n+v);if($!==e.charCodeAt(o+v))break;$===47&&(b=v)}var j="";for(v=n+b+1;v<=s;++v)v!==s&&t.charCodeAt(v)!==47||(j.length===0?j+="..":j+="/..");return j.length>0?j+e.slice(o+b):(o+=b,e.charCodeAt(o)===47&&++o,e.slice(o))},_makeLong:function(t){return t},dirname:function(t){if(m(t),t.length===0)return".";for(var e=t.charCodeAt(0),n=e===47,s=-1,i=!0,o=t.length-1;o>=1;--o)if((e=t.charCodeAt(o))===47){if(!i){s=o;break}}else i=!1;return s===-1?n?"/":".":n&&s===1?"//":t.slice(0,s)},basename:function(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');m(t);var n,s=0,i=-1,o=!0;if(e!==void 0&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var l=e.length-1,u=-1;for(n=t.length-1;n>=0;--n){var b=t.charCodeAt(n);if(b===47){if(!o){s=n+1;break}}else u===-1&&(o=!1,u=n+1),l>=0&&(b===e.charCodeAt(l)?--l==-1&&(i=n):(l=-1,i=u))}return s===i?i=u:i===-1&&(i=t.length),t.slice(s,i)}for(n=t.length-1;n>=0;--n)if(t.charCodeAt(n)===47){if(!o){s=n+1;break}}else i===-1&&(o=!1,i=n+1);return i===-1?"":t.slice(s,i)},extname:function(t){m(t);for(var e=-1,n=0,s=-1,i=!0,o=0,l=t.length-1;l>=0;--l){var u=t.charCodeAt(l);if(u!==47)s===-1&&(i=!1,s=l+1),u===46?e===-1?e=l:o!==1&&(o=1):e!==-1&&(o=-1);else if(!i){n=l+1;break}}return e===-1||s===-1||o===0||o===1&&e===s-1&&e===n+1?"":t.slice(e,s)},format:function(t){if(t===null||typeof t!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return function(e,n){var s=n.dir||n.root,i=n.base||(n.name||"")+(n.ext||"");return s?s===n.root?s+i:s+"/"+i:i}(0,t)},parse:function(t){m(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(t.length===0)return e;var n,s=t.charCodeAt(0),i=s===47;i?(e.root="/",n=1):n=0;for(var o=-1,l=0,u=-1,b=!0,v=t.length-1,$=0;v>=n;--v)if((s=t.charCodeAt(v))!==47)u===-1&&(b=!1,u=v+1),s===46?o===-1?o=v:$!==1&&($=1):o!==-1&&($=-1);else if(!b){l=v+1;break}return o===-1||u===-1||$===0||$===1&&o===u-1&&o===l+1?u!==-1&&(e.base=e.name=l===0&&i?t.slice(1,u):t.slice(l,u)):(l===0&&i?(e.name=t.slice(1,o),e.base=t.slice(1,u)):(e.name=t.slice(l,o),e.base=t.slice(l,u)),e.ext=t.slice(o,u)),l>0?e.dir=t.slice(0,l-1):i&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};k.posix=k,p.exports=k}},f={};function w(p){var m=f[p];if(m!==void 0)return m.exports;var x=f[p]={exports:{}};return y[p](x,x.exports,w),x.exports}w.d=(p,m)=>{for(var x in m)w.o(m,x)&&!w.o(p,x)&&Object.defineProperty(p,x,{enumerable:!0,get:m[x]})},w.o=(p,m)=>Object.prototype.hasOwnProperty.call(p,m),w.r=p=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(p,"__esModule",{value:!0})};var I={};(()=>{let p;w.r(I),w.d(I,{URI:()=>i,Utils:()=>L}),typeof process=="object"?p=process.platform==="win32":typeof navigator=="object"&&(p=navigator.userAgent.indexOf("Windows")>=0);let m=/^\w[\w\d+.-]*$/,x=/^\//,k=/^\/\//;function t(a,r){if(!a.scheme&&r)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${a.authority}", path: "${a.path}", query: "${a.query}", fragment: "${a.fragment}"}`);if(a.scheme&&!m.test(a.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(a.path){if(a.authority){if(!x.test(a.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(k.test(a.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}let e="",n="/",s=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/;class i{static isUri(r){return r instanceof i||!!r&&typeof r.authority=="string"&&typeof r.fragment=="string"&&typeof r.path=="string"&&typeof r.query=="string"&&typeof r.scheme=="string"&&typeof r.fsPath=="string"&&typeof r.with=="function"&&typeof r.toString=="function"}scheme;authority;path;query;fragment;constructor(r,h,c,C,d,g=!1){typeof r=="object"?(this.scheme=r.scheme||e,this.authority=r.authority||e,this.path=r.path||e,this.query=r.query||e,this.fragment=r.fragment||e):(this.scheme=function(S,O){return S||O?S:"file"}(r,g),this.authority=h||e,this.path=function(S,O){switch(S){case"https":case"http":case"file":O?O[0]!==n&&(O=n+O):O=n}return O}(this.scheme,c||e),this.query=C||e,this.fragment=d||e,t(this,g))}get fsPath(){return $(this,!1)}with(r){if(!r)return this;let{scheme:h,authority:c,path:C,query:d,fragment:g}=r;return h===void 0?h=this.scheme:h===null&&(h=e),c===void 0?c=this.authority:c===null&&(c=e),C===void 0?C=this.path:C===null&&(C=e),d===void 0?d=this.query:d===null&&(d=e),g===void 0?g=this.fragment:g===null&&(g=e),h===this.scheme&&c===this.authority&&C===this.path&&d===this.query&&g===this.fragment?this:new l(h,c,C,d,g)}static parse(r,h=!1){let c=s.exec(r);return c?new l(c[2]||e,T(c[4]||e),T(c[5]||e),T(c[7]||e),T(c[9]||e),h):new l(e,e,e,e,e)}static file(r){let h=e;if(p&&(r=r.replace(/\\/g,n)),r[0]===n&&r[1]===n){let c=r.indexOf(n,2);c===-1?(h=r.substring(2),r=n):(h=r.substring(2,c),r=r.substring(c)||n)}return new l("file",h,r,e,e)}static from(r){let h=new l(r.scheme,r.authority,r.path,r.query,r.fragment);return t(h,!0),h}toString(r=!1){return j(this,r)}toJSON(){return this}static revive(r){if(r){if(r instanceof i)return r;{let h=new l(r);return h._formatted=r.external,h._fsPath=r._sep===o?r.fsPath:null,h}}return r}}let o=p?1:void 0;class l extends i{_formatted=null;_fsPath=null;get fsPath(){return this._fsPath||(this._fsPath=$(this,!1)),this._fsPath}toString(r=!1){return r?j(this,!0):(this._formatted||(this._formatted=j(this,!1)),this._formatted)}toJSON(){let r={$mid:1};return this._fsPath&&(r.fsPath=this._fsPath,r._sep=o),this._formatted&&(r.external=this._formatted),this.path&&(r.path=this.path),this.scheme&&(r.scheme=this.scheme),this.authority&&(r.authority=this.authority),this.query&&(r.query=this.query),this.fragment&&(r.fragment=this.fragment),r}}let u={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function b(a,r,h){let c,C=-1;for(let d=0;d<a.length;d++){let g=a.charCodeAt(d);if(g>=97&&g<=122||g>=65&&g<=90||g>=48&&g<=57||g===45||g===46||g===95||g===126||r&&g===47||h&&g===91||h&&g===93||h&&g===58)C!==-1&&(c+=encodeURIComponent(a.substring(C,d)),C=-1),c!==void 0&&(c+=a.charAt(d));else{c===void 0&&(c=a.substr(0,d));let S=u[g];S!==void 0?(C!==-1&&(c+=encodeURIComponent(a.substring(C,d)),C=-1),c+=S):C===-1&&(C=d)}}return C!==-1&&(c+=encodeURIComponent(a.substring(C))),c!==void 0?c:a}function v(a){let r;for(let h=0;h<a.length;h++){let c=a.charCodeAt(h);c===35||c===63?(r===void 0&&(r=a.substr(0,h)),r+=u[c]):r!==void 0&&(r+=a[h])}return r!==void 0?r:a}function $(a,r){let h;return h=a.authority&&a.path.length>1&&a.scheme==="file"?`//${a.authority}${a.path}`:a.path.charCodeAt(0)===47&&(a.path.charCodeAt(1)>=65&&a.path.charCodeAt(1)<=90||a.path.charCodeAt(1)>=97&&a.path.charCodeAt(1)<=122)&&a.path.charCodeAt(2)===58?r?a.path.substr(1):a.path[1].toLowerCase()+a.path.substr(2):a.path,p&&(h=h.replace(/\//g,"\\")),h}function j(a,r){let h=r?v:b,c="",{scheme:C,authority:d,path:g,query:S,fragment:O}=a;if(C&&(c+=C,c+=":"),(d||C==="file")&&(c+=n,c+=n),d){let A=d.indexOf("@");if(A!==-1){let q=d.substr(0,A);d=d.substr(A+1),A=q.lastIndexOf(":"),A===-1?c+=h(q,!1,!1):(c+=h(q.substr(0,A),!1,!1),c+=":",c+=h(q.substr(A+1),!1,!0)),c+="@"}d=d.toLowerCase(),A=d.lastIndexOf(":"),A===-1?c+=h(d,!1,!0):(c+=h(d.substr(0,A),!1,!0),c+=d.substr(A))}if(g){if(g.length>=3&&g.charCodeAt(0)===47&&g.charCodeAt(2)===58){let A=g.charCodeAt(1);A>=65&&A<=90&&(g=`/${String.fromCharCode(A+32)}:${g.substr(3)}`)}else if(g.length>=2&&g.charCodeAt(1)===58){let A=g.charCodeAt(0);A>=65&&A<=90&&(g=`${String.fromCharCode(A+32)}:${g.substr(2)}`)}c+=h(g,!0,!1)}return S&&(c+="?",c+=h(S,!1,!1)),O&&(c+="#",c+=r?O:b(O,!1,!1)),c}function B(a){try{return decodeURIComponent(a)}catch{return a.length>3?a.substr(0,3)+B(a.substr(3)):a}}let R=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function T(a){return a.match(R)?a.replace(R,r=>B(r)):a}var M=w(470);let D=M.posix||M,U="/";var L;(function(a){a.joinPath=function(r,...h){return r.with({path:D.join(r.path,...h)})},a.resolvePath=function(r,...h){let c=r.path,C=!1;c[0]!==U&&(c=U+c,C=!0);let d=D.resolve(c,...h);return C&&d[0]===U&&!r.authority&&(d=d.substring(1)),r.with({path:d})},a.dirname=function(r){if(r.path.length===0||r.path===U)return r;let h=D.dirname(r.path);return h.length===1&&h.charCodeAt(0)===46&&(h=""),r.with({path:h})},a.basename=function(r){return D.basename(r.path)},a.extname=function(r){return D.extname(r.path)}})(L||(L={}))})(),W=I})();var{URI:J,Utils:fe}=W;var N=require("path"),K=require("pretty-ts-errors-markdown"),F="pretty-ts-errors",_="tsserver";async function re(y){let{nvim:f}=P.workspace,I=(await f.getOption("runtimepath")).split(","),p=(0,N.join)(y,"runtime");I.includes(p)||await f.command(`execute 'noa set rtp+='.fnameescape('${p.replace(/'/g,"''")}')`),await f.command("call prettytserr#init()")}function ne(y){let f=/```[\s\S]*?```/g,w=/`([^`]+)`/g,I=[];return y.replace(f,k=>(I.push(k),"\0")).replace(/</g,"\\<").replace(/>/g,"\\>").replace(w,"\x1B[33m$1\x1B[0m").replace(/\0/g,()=>I.shift()||"")}var se=y=>`\x1B[31m${y}\x1B[0m`,ie=y=>`\x1B[32m${y}\x1B[0m`,Z=y=>`\x1B[36m${y}\x1B[0m`,ae={[P.DiagnosticSeverity.Error]:se,[P.DiagnosticSeverity.Warning]:ie,[P.DiagnosticSeverity.Information]:Z,[P.DiagnosticSeverity.Hint]:Z},oe=(y,f)=>y.map(I=>{var k,t;let p="",m=Object.assign({},I);if(m.message.includes(`

Related diagnostics:`)){let e=(k=m.message.split(`

Related diagnostics:`))==null?void 0:k[0];m.message=e}try{if(f.separateDiagnostics&&((t=m.relatedInformation)!=null&&t.length)){p=`

\x1B[35mRelated diagnostics:\x1B[0m
`;for(let e of m.relatedInformation){let n=J.parse(e.location.uri).fsPath,s=(0,N.basename)(n),i=e.location.range.start.line+1,o=e.location.range.start.character+1;p=`${p}
  - [${s}#${i},${o}](${n}): ${e.message}`}}}catch{}let x=ne((0,K.formatDiagnostic)(m)).split(`
`).map((e,n)=>{if(n===0&&(e=ae[m.severity||P.DiagnosticSeverity.Error](e.substring(3,e.length))),e=e.replace(/(\['+)([^' ]+)('+.+?📄\])/g,(s,i,o)=>`[${o}]`),f.showLink===!1&&(e=e.replace(/\[(🔗|🌐)\]\(.*\)/g,"")),f.codeBlockHighlightType==="prettytserr")e=e.replace(/(?<=(^\s*```))typescript/,"prettytserr");else{let s=e.match(/^(\s*)```typescript.*/),i=(s==null?void 0:s[1].length)||0;e=e.replace(/(?<=(^\s*```))typescript/,`typescript
${" ".repeat(i)}type Type =`)}return e}).join(`
`);return{...m,message:`${x}${p}

`,filetype:"markdown",source:F}}),G={},E=class E{constructor(f){this.value=f;this.value=f}showInDiagnostic(){return this.value===E.Diagnostic||this.value===E.Both}showInHover(){return this.value===E.Hover||this.value===E.Both}};E.Diagnostic=0,E.Hover=1,E.Both=2;var H=E;async function ce(y){let f=P.workspace.getConfiguration(F),w=f.get("enable",!0),I=f.get("showLink",!1),p=f.get("mode",H.Both),m=f.get("codeBlockHighlightType","prettytserr"),x=f.get("serverName",_),k=f.get("separateDiagnostics",void 0);if(_=x,!w)return null;let t=new H(p),e=P.services.getService(_),n=f.get("experimental.filterOriginalTsErrors",!0);if(!e)return console.error(`Tsserver not found: serverName '${_}' is not available.`),null;e.onServiceReady(()=>{var o,l;re(y.extensionPath),k===void 0&&(k=(l=(o=e==null?void 0:e.client)==null?void 0:o.clientOptions)==null?void 0:l.separateDiagnostics);let s=P.diagnosticManager.create(F),i=P.diagnosticManager.getCollectionByName(x);i==null||i.onDidDiagnosticsChange(u=>{let b=P.workspace.getDocument(u);if((b==null?void 0:b.bufnr)!==void 0){let $=P.diagnosticManager.buffers.getItem(b==null?void 0:b.bufnr);if($){let B=P.diagnosticManager.getDiagnostics($)[x],R=oe(B,{showLink:I,codeBlockHighlightType:m,separateDiagnostics:k});setTimeout(()=>{G[u]=[...R],t.showInDiagnostic()&&(n&&(i.diagnosticsMap.delete(u),$.config.autoRefresh&&$.update(x,[])),s.set(u,R))})}}})}),y.subscriptions.push(P.languages.registerHoverProvider([{language:"javascript"},{language:"javascriptreact"},{language:"javascript.jsx"},{language:"typescript"},{language:"typescriptreact"},{language:"typescript.tsx"},{language:"typescript.jsx"},{language:"jsx-tags"},{language:"jsonc"},{language:"vue"}],{provideHover:(s,i)=>{var l;return t.showInHover()?{contents:(l=G[s.uri])==null?void 0:l.map(u=>he(i,u.range)?{language:"markdown",value:u.message}:null).filter(Boolean)}:null}}))}function he(y,f){let w=!0;return(y.line<f.start.line||y.line>f.end.line)&&(w=!1),y.line===f.start.line&&y.character<f.start.character&&(w=!1),y.line===f.end.line&&y.character>f.end.character&&(w=!1),w}0&&(module.exports={activate});
